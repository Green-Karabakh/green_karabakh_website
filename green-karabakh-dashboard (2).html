<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Green Karabakh ‚Äî Enerji ƒ∞dar…ôetm…ô Sistemi</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;600;700&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');

  :root {
    --bg-deep: #020d0a;
    --bg-panel: #061a14;
    --bg-card: #0a2a1e;
    --green-neon: #00ff88;
    --green-mid: #00c96a;
    --green-dark: #007a3d;
    --teal: #00e5cc;
    --blue-dark: #003d5c;
    --blue-mid: #005f8a;
    --gold: #ffd700;
    --red-alert: #ff2244;
    --orange: #ff7b00;
    --text-primary: #c8ffe8;
    --text-dim: #4a8a6a;
    --border: rgba(0,255,136,0.15);
    --border-bright: rgba(0,255,136,0.4);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-deep);
    color: var(--text-primary);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 20% 20%, rgba(0,255,136,0.04) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgba(0,100,200,0.06) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  /* Grid background */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,255,136,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,136,0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  /* HEADER */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 0 30px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 30px;
  }

  .logo-area {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo-icon {
    width: 52px;
    height: 52px;
    border: 2px solid var(--green-neon);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
    box-shadow: 0 0 20px rgba(0,255,136,0.3), inset 0 0 20px rgba(0,255,136,0.05);
    animation: pulse-border 3s ease-in-out infinite;
  }

  @keyframes pulse-border {
    0%, 100% { box-shadow: 0 0 20px rgba(0,255,136,0.3), inset 0 0 20px rgba(0,255,136,0.05); }
    50% { box-shadow: 0 0 40px rgba(0,255,136,0.6), inset 0 0 30px rgba(0,255,136,0.1); }
  }

  .logo-text h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 22px;
    font-weight: 900;
    color: var(--green-neon);
    letter-spacing: 3px;
    text-shadow: 0 0 20px rgba(0,255,136,0.5);
  }

  .logo-text p {
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 4px;
    text-transform: uppercase;
    margin-top: 2px;
  }

  .header-right {
    text-align: right;
  }

  .live-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(0,255,136,0.08);
    border: 1px solid var(--border-bright);
    padding: 6px 14px;
    border-radius: 20px;
    font-family: 'Share Tech Mono', monospace;
    font-size: 11px;
    color: var(--green-neon);
    margin-bottom: 6px;
  }

  .live-dot {
    width: 8px; height: 8px;
    background: var(--green-neon);
    border-radius: 50%;
    animation: blink 1s ease-in-out infinite;
    box-shadow: 0 0 8px var(--green-neon);
  }

  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

  #clock {
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    color: var(--text-dim);
  }

  /* ALERT BANNER */
  #alert-banner {
    display: none;
    background: rgba(255,34,68,0.12);
    border: 2px solid var(--red-alert);
    border-radius: 10px;
    padding: 14px 24px;
    margin-bottom: 20px;
    text-align: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 14px;
    color: var(--red-alert);
    letter-spacing: 2px;
    animation: alert-flash 0.8s ease-in-out infinite;
    box-shadow: 0 0 30px rgba(255,34,68,0.2);
  }

  @keyframes alert-flash {
    0%,100%{opacity:1} 50%{opacity:0.6}
  }

  /* SCENARIO BUTTONS */
  .scenario-section {
    margin-bottom: 30px;
  }

  .section-label {
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .scenario-buttons {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .btn-scenario {
    font-family: 'Rajdhani', sans-serif;
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 2px;
    padding: 12px 28px;
    border-radius: 8px;
    border: 1px solid;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
  }

  .btn-scenario::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
    transition: left 0.4s ease;
  }

  .btn-scenario:hover::before { left: 100%; }

  .btn-normal {
    background: rgba(0,201,106,0.1);
    border-color: var(--green-mid);
    color: var(--green-mid);
  }

  .btn-normal:hover, .btn-normal.active {
    background: rgba(0,201,106,0.25);
    box-shadow: 0 0 20px rgba(0,201,106,0.4);
  }

  .btn-cloudy {
    background: rgba(0,229,204,0.08);
    border-color: var(--teal);
    color: var(--teal);
  }

  .btn-cloudy:hover, .btn-cloudy.active {
    background: rgba(0,229,204,0.2);
    box-shadow: 0 0 20px rgba(0,229,204,0.4);
  }

  .btn-critical {
    background: rgba(255,34,68,0.08);
    border-color: var(--red-alert);
    color: var(--red-alert);
  }

  .btn-critical:hover, .btn-critical.active {
    background: rgba(255,34,68,0.2);
    box-shadow: 0 0 20px rgba(255,34,68,0.4);
  }

  /* MAIN GRID */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 320px;
    grid-template-rows: auto auto;
    gap: 20px;
    margin-bottom: 20px;
  }

  /* PIE CHART PANEL */
  .pie-panel {
    background: var(--bg-panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    display: flex;
    flex-direction: column;
    align-items: center;
    grid-row: span 2;
  }

  .panel-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--green-neon);
    text-align: center;
    margin-bottom: 24px;
    text-transform: uppercase;
  }

  .pie-wrapper {
    position: relative;
    width: 280px;
    height: 280px;
    margin-bottom: 30px;
  }

  canvas#pieChart {
    width: 100%;
    height: 100%;
    filter: drop-shadow(0 0 20px rgba(0,255,136,0.2));
  }

  .pie-center {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    pointer-events: none;
  }

  .pie-center-label {
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--text-dim);
    text-transform: uppercase;
  }

  .pie-center-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--green-neon);
    text-shadow: 0 0 20px rgba(0,255,136,0.6);
    line-height: 1;
  }

  .pie-legend {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .legend-name {
    flex: 1;
    font-size: 13px;
    color: var(--text-primary);
    letter-spacing: 1px;
  }

  .legend-pct {
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    font-weight: 700;
  }

  .legend-bar-wrap {
    width: 100%;
    height: 3px;
    background: rgba(255,255,255,0.05);
    border-radius: 2px;
    margin-top: 4px;
    display: none;
  }

  /* SOURCE CARDS */
  .sources-panel {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .source-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px 18px;
    transition: all 0.5s ease;
    position: relative;
    overflow: hidden;
  }

  .source-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 3px; height: 100%;
    border-radius: 10px 0 0 10px;
  }

  .source-card-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .source-name {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .source-icon { font-size: 18px; }

  .source-pct {
    font-family: 'Orbitron', sans-serif;
    font-size: 18px;
    font-weight: 700;
  }

  .source-bar-bg {
    height: 5px;
    background: rgba(255,255,255,0.06);
    border-radius: 3px;
    overflow: hidden;
  }

  .source-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 1s cubic-bezier(0.4,0,0.2,1);
  }

  .source-status {
    font-size: 10px;
    letter-spacing: 1px;
    color: var(--text-dim);
    margin-top: 6px;
    font-family: 'Share Tech Mono', monospace;
  }

  /* STORAGE PANEL */
  .storage-panel {
    background: var(--bg-panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 22px;
  }

  .storage-inner {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .battery-visual {
    position: relative;
    width: 60px;
    flex-shrink: 0;
  }

  .battery-body {
    border: 2px solid var(--green-mid);
    border-radius: 6px;
    height: 100px;
    width: 44px;
    position: relative;
    overflow: hidden;
    background: rgba(0,201,106,0.04);
  }

  .battery-tip {
    width: 20px;
    height: 8px;
    background: var(--green-mid);
    border-radius: 3px 3px 0 0;
    margin: 0 auto;
    margin-bottom: 2px;
  }

  .battery-fill {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    background: linear-gradient(180deg, var(--green-neon), var(--green-dark));
    transition: height 1s ease;
    border-radius: 0 0 4px 4px;
  }

  .battery-fill.charging {
    animation: charge-anim 1.5s ease-in-out infinite;
  }

  .battery-fill.discharging {
    background: linear-gradient(180deg, var(--teal), var(--blue-mid));
    animation: discharge-pulse 1.5s ease-in-out infinite;
  }

  .battery-fill.critical {
    background: linear-gradient(180deg, var(--orange), var(--red-alert));
    animation: critical-pulse 0.5s ease-in-out infinite;
  }

  @keyframes charge-anim {
    0%,100%{filter:brightness(1)} 50%{filter:brightness(1.4)}
  }

  @keyframes discharge-pulse {
    0%,100%{opacity:1} 50%{opacity:0.7}
  }

  @keyframes critical-pulse {
    0%,100%{filter:brightness(1)} 50%{filter:brightness(1.8)}
  }

  .storage-info { flex: 1; }

  .storage-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--green-neon);
    margin-bottom: 8px;
    text-transform: uppercase;
  }

  .storage-level {
    font-family: 'Orbitron', sans-serif;
    font-size: 32px;
    font-weight: 700;
    color: var(--green-neon);
    text-shadow: 0 0 15px rgba(0,255,136,0.5);
  }

  .storage-status-text {
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    margin-top: 6px;
    padding: 4px 10px;
    border-radius: 4px;
    display: inline-block;
    transition: all 0.3s ease;
  }

  .status-charging { background: rgba(0,255,136,0.15); color: var(--green-neon); border: 1px solid var(--green-neon); }
  .status-discharging { background: rgba(0,229,204,0.15); color: var(--teal); border: 1px solid var(--teal); }
  .status-idle { background: rgba(255,255,255,0.05); color: var(--text-dim); border: 1px solid rgba(255,255,255,0.1); }
  .status-critical { background: rgba(255,34,68,0.15); color: var(--red-alert); border: 1px solid var(--red-alert); animation: alert-flash 0.5s infinite; }

  /* TOTAL OUTPUT */
  .output-panel {
    background: var(--bg-panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 22px;
  }

  .output-main {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    margin-top: 10px;
  }

  .output-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 42px;
    font-weight: 900;
    color: var(--green-neon);
    text-shadow: 0 0 25px rgba(0,255,136,0.5);
    line-height: 1;
    transition: color 0.5s ease;
  }

  .output-unit {
    font-size: 16px;
    color: var(--text-dim);
    margin-bottom: 8px;
    letter-spacing: 1px;
  }

  .sparkline-wrap {
    margin-top: 12px;
  }

  canvas#sparkline {
    width: 100%;
    height: 50px;
  }

  /* SYSTEM LOG */
  .log-panel {
    background: var(--bg-panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 22px;
  }

  .log-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }

  .log-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--green-neon);
    text-transform: uppercase;
  }

  .log-clear {
    font-size: 10px;
    letter-spacing: 1px;
    color: var(--text-dim);
    cursor: pointer;
    background: none;
    border: 1px solid rgba(255,255,255,0.1);
    padding: 3px 10px;
    border-radius: 4px;
    color: var(--text-dim);
    font-family: 'Share Tech Mono', monospace;
    transition: all 0.2s;
  }

  .log-clear:hover { border-color: var(--green-neon); color: var(--green-neon); }

  .log-container {
    height: 140px;
    overflow-y: auto;
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    line-height: 1.8;
  }

  .log-container::-webkit-scrollbar { width: 4px; }
  .log-container::-webkit-scrollbar-track { background: transparent; }
  .log-container::-webkit-scrollbar-thumb { background: var(--green-dark); border-radius: 2px; }

  .log-line {
    display: flex;
    gap: 12px;
    padding: 3px 0;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    animation: log-in 0.3s ease;
  }

  @keyframes log-in {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .log-time { color: var(--text-dim); flex-shrink: 0; }
  .log-source { color: var(--teal); flex-shrink: 0; min-width: 30px; }
  .log-msg { color: var(--text-primary); }
  .log-msg.warn { color: var(--orange); }
  .log-msg.error { color: var(--red-alert); }
  .log-msg.success { color: var(--green-neon); }
  .log-msg.info { color: var(--teal); }

  /* COLORS for sources */
  .c-solar { color: #ffd700; }
  .c-wind { color: #00e5cc; }
  .c-biogas { color: #7fff7f; }
  .c-storage { color: #4dd9ff; }
  .c-piezo { color: #b580ff; }

  .solar-card::before { background: #ffd700; }
  .wind-card::before { background: #00e5cc; }
  .biogas-card::before { background: #7fff7f; }
  .storage-card::before { background: #4dd9ff; }
  .piezo-card::before { background: #b580ff; }

  /* BOTTOM STATS */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    margin-bottom: 20px;
  }

  .stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    text-align: center;
  }

  .stat-val {
    font-family: 'Orbitron', sans-serif;
    font-size: 22px;
    font-weight: 700;
    color: var(--green-neon);
    text-shadow: 0 0 10px rgba(0,255,136,0.4);
  }

  .stat-lbl {
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-top: 4px;
  }

  /* DISTRIBUTION MAP */
  .map-panel {
    background: var(--bg-panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }

  .map-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse 70% 60% at 50% 50%, rgba(0,255,136,0.03) 0%, transparent 70%);
    pointer-events: none;
  }

  .map-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .map-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--green-neon);
    text-transform: uppercase;
  }

  .map-subtitle {
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 2px;
    margin-top: 4px;
  }

  .map-legend-row {
    display: flex;
    gap: 18px;
    flex-wrap: wrap;
  }

  .map-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 1px;
  }

  .map-legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .map-svg-container {
    width: 100%;
    position: relative;
    background: rgba(0,20,12,0.6);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
  }

  .map-svg-container svg {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Pulsing animation for active nodes */
  .node-pulse {
    animation: node-ping 2s ease-out infinite;
    transform-origin: center;
  }

  @keyframes node-ping {
    0% { opacity: 1; r: 0; }
    80% { opacity: 0; }
    100% { opacity: 0; r: 22; }
  }

  .power-line {
    stroke-dasharray: 6 4;
    animation: dash-flow 1.5s linear infinite;
  }

  @keyframes dash-flow {
    to { stroke-dashoffset: -20; }
  }

  .power-line-critical {
    stroke-dasharray: 6 4;
    animation: dash-flow-fast 0.4s linear infinite;
  }

  @keyframes dash-flow-fast {
    to { stroke-dashoffset: -20; }
  }

  .map-node-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px;
    fill: var(--text-primary);
    text-anchor: middle;
  }

  .map-node-val {
    font-family: 'Orbitron', monospace;
    font-size: 8px;
    font-weight: 700;
    text-anchor: middle;
  }

  .map-bottom-stats {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
    margin-top: 16px;
  }

  .map-stat-item {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    text-align: center;
    transition: border-color 0.5s;
  }

  .map-stat-icon { font-size: 18px; margin-bottom: 4px; }

  .map-stat-name {
    font-size: 9px;
    letter-spacing: 1px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  .map-stat-kw {
    font-family: 'Orbitron', sans-serif;
    font-size: 13px;
    font-weight: 700;
    transition: color 0.5s;
  }

  .map-stat-pct {
    font-size: 10px;
    color: var(--text-dim);
    margin-top: 2px;
    font-family: 'Share Tech Mono', monospace;
  }

  /* RESPONSIVE */
  @media (max-width: 900px) {
    .map-bottom-stats { grid-template-columns: repeat(3, 1fr); }
    .main-grid { grid-template-columns: 1fr; }
    .stats-row { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <header>
    <div class="logo-area">
      <div class="logo-icon">üåø</div>
      <div class="logo-text">
        <h1>GREEN KARABAKH</h1>
        <p>Enerji ƒ∞dar…ôetm…ô Sistemi ¬∑ AI N…ôzar…ôti</p>
      </div>
    </div>
    <div class="header-right">
      <div class="live-indicator">
        <span class="live-dot"></span>
        <span>Sƒ∞STEM AKTIV</span>
      </div>
      <div id="clock">--:--:--</div>
    </div>
  </header>

  <!-- ALERT BANNER -->
  <div id="alert-banner">‚ö† Dƒ∞QQ∆èT: Kritik Enerji D√º≈ü√º≈ü√º! AI Tam Storage Rejimin…ô Ke√ßdi! ‚ö†</div>

  <!-- SCENARIO BUTTONS -->
  <div class="scenario-section">
    <div class="section-label">Ssenari Se√ßimi</div>
    <div class="scenario-buttons">
      <button class="btn-scenario btn-normal active" onclick="setScenario('normal')">‚ö° Normal Rejim</button>
      <button class="btn-scenario btn-cloudy" onclick="setScenario('cloudy')">‚òÅ Buludlu Hava</button>
      <button class="btn-scenario btn-critical" onclick="setScenario('critical')">üî¥ Kritik Hal</button>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="main-grid">

    <!-- PIE CHART -->
    <div class="pie-panel">
      <div class="panel-title">Enerji M…ônb…ôyi Paylanmasƒ±</div>
      <div class="pie-wrapper">
        <canvas id="pieChart" width="280" height="280"></canvas>
        <div class="pie-center">
          <div class="pie-center-label">√úmumi</div>
          <div class="pie-center-value" id="totalPct">100%</div>
        </div>
      </div>
      <div class="pie-legend" id="pieLegend"></div>
    </div>

    <!-- RIGHT COLUMN -->
    <div style="display:flex;flex-direction:column;gap:16px;">

      <!-- TOTAL OUTPUT -->
      <div class="output-panel">
        <div class="panel-title" style="margin-bottom:4px">√úmumi √áƒ±xƒ±≈ü G√ºc√º</div>
        <div class="output-main">
          <div class="output-value" id="outputValue">500</div>
          <div class="output-unit">MW</div>
        </div>
        <div class="sparkline-wrap">
          <canvas id="sparkline" width="280" height="50"></canvas>
        </div>
      </div>

      <!-- STORAGE -->
      <div class="storage-panel">
        <div class="storage-inner">
          <div class="battery-visual">
            <div class="battery-tip"></div>
            <div class="battery-body">
              <div class="battery-fill" id="batteryFill" style="height:72%"></div>
            </div>
          </div>
          <div class="storage-info">
            <div class="storage-title">Iron-Air Storage</div>
            <div class="storage-level" id="storageLevel">72%</div>
            <div class="storage-status-text status-idle" id="storageStatusText">G√∂zl…ôm…ô Rejimi</div>
          </div>
        </div>
      </div>

      <!-- SOURCE CARDS -->
      <div class="sources-panel" id="sourceCards"></div>

    </div>
  </div>

  <!-- STATS ROW -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-val" id="stat-solar">340</div>
      <div class="stat-lbl">G√ºn…ô≈ü (MW)</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" id="stat-wind">255</div>
      <div class="stat-lbl">K√ºl…ôk (MW)</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" id="stat-co2">0</div>
      <div class="stat-lbl">CO‚ÇÇ Azalma (Ton/G√ºn)</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" id="stat-efficiency">98.2%</div>
      <div class="stat-lbl">Sistem Effektivliyi</div>
    </div>
  </div>

  <!-- ENERGY DISTRIBUTION MAP -->
  <div class="map-panel">
    <div class="map-header">
      <div>
        <div class="map-title">üó∫ Enerji Paylanma X…ôrit…ôsi ‚Äî Qarabaƒü ≈û…ôh…ôri</div>
        <div class="map-subtitle">Real-vaxt ≈ü…ôb…ôk…ô paylanmasƒ± ¬∑ AI idar…ôetm…ô</div>
      </div>
      <div class="map-legend-row">
        <div class="map-legend-item"><div class="map-legend-dot" style="background:#ffd700"></div>X…ôst…ôxana</div>
        <div class="map-legend-item"><div class="map-legend-dot" style="background:#00e5cc"></div>T…ôhsil</div>
        <div class="map-legend-item"><div class="map-legend-dot" style="background:#b580ff"></div>Data M…ôrk…ôzi</div>
        <div class="map-legend-item"><div class="map-legend-dot" style="background:#00ff88"></div>Ya≈üayƒ±≈ü</div>
        <div class="map-legend-item"><div class="map-legend-dot" style="background:#ff7b00"></div>S…ônaye</div>
        <div class="map-legend-item"><div class="map-legend-dot" style="background:#4dd9ff"></div>ƒ∞ctimai</div>
      </div>
    </div>

    <div class="map-svg-container">
      <svg viewBox="0 0 900 480" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <filter id="glow-green">
            <feGaussianBlur stdDeviation="3" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
          <filter id="glow-gold">
            <feGaussianBlur stdDeviation="4" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
          <radialGradient id="hub-grad" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#00ff88" stop-opacity="0.4"/>
            <stop offset="100%" stop-color="#00ff88" stop-opacity="0"/>
          </radialGradient>
        </defs>

        <!-- Background city grid -->
        <rect width="900" height="480" fill="#040f0a"/>
        <!-- City block fills (background buildings silhouette) -->
        <rect x="0" y="0" width="900" height="480" fill="url(#city-bg)" opacity="0.3"/>

        <!-- Road grid lines -->
        <g stroke="rgba(0,255,136,0.06)" stroke-width="1">
          <line x1="150" y1="0" x2="150" y2="480"/>
          <line x1="300" y1="0" x2="300" y2="480"/>
          <line x1="450" y1="0" x2="450" y2="480"/>
          <line x1="600" y1="0" x2="600" y2="480"/>
          <line x1="750" y1="0" x2="750" y2="480"/>
          <line x1="0" y1="120" x2="900" y2="120"/>
          <line x1="0" y1="240" x2="900" y2="240"/>
          <line x1="0" y1="360" x2="900" y2="360"/>
        </g>

        <!-- City block rectangles -->
        <g fill="rgba(0,40,20,0.5)" stroke="rgba(0,255,136,0.08)" stroke-width="0.5">
          <rect x="20" y="20" width="110" height="80" rx="3"/>
          <rect x="20" y="140" width="110" height="80" rx="3"/>
          <rect x="20" y="260" width="110" height="80" rx="3"/>
          <rect x="20" y="380" width="110" height="80" rx="3"/>
          <rect x="160" y="20" width="120" height="80" rx="3"/>
          <rect x="160" y="140" width="120" height="80" rx="3"/>
          <rect x="160" y="260" width="120" height="80" rx="3"/>
          <rect x="160" y="380" width="120" height="80" rx="3"/>
          <rect x="310" y="20" width="120" height="80" rx="3"/>
          <rect x="310" y="260" width="120" height="80" rx="3"/>
          <rect x="310" y="380" width="120" height="80" rx="3"/>
          <rect x="460" y="20" width="120" height="80" rx="3"/>
          <rect x="460" y="140" width="120" height="80" rx="3"/>
          <rect x="460" y="380" width="120" height="80" rx="3"/>
          <rect x="610" y="20" width="120" height="80" rx="3"/>
          <rect x="610" y="140" width="120" height="80" rx="3"/>
          <rect x="610" y="260" width="120" height="80" rx="3"/>
          <rect x="610" y="380" width="120" height="80" rx="3"/>
          <rect x="760" y="20" width="120" height="80" rx="3"/>
          <rect x="760" y="140" width="120" height="80" rx="3"/>
          <rect x="760" y="260" width="120" height="80" rx="3"/>
          <rect x="760" y="380" width="120" height="80" rx="3"/>
        </g>

        <!-- POWER LINES from Hub to nodes -->
        <!-- Hub is at 450, 240 (center) -->
        <!-- Hospital 1 (160, 80) -->
        <line class="power-line" id="line-hosp1" x1="450" y1="240" x2="165" y2="85" stroke="#ffd700" stroke-width="1.5" opacity="0.7"/>
        <!-- Hospital 2 (740, 80) -->
        <line class="power-line" id="line-hosp2" x1="450" y1="240" x2="738" y2="85" stroke="#ffd700" stroke-width="1.5" opacity="0.7"/>
        <!-- University (450, 40) -->
        <line class="power-line" id="line-uni" x1="450" y1="240" x2="450" y2="55" stroke="#00e5cc" stroke-width="1.5" opacity="0.7"/>
        <!-- School (80, 200) -->
        <line class="power-line" id="line-school" x1="450" y1="240" x2="85" y2="205" stroke="#00e5cc" stroke-width="1.5" opacity="0.7"/>
        <!-- Data Center (800, 300) -->
        <line class="power-line" id="line-dc" x1="450" y1="240" x2="795" y2="305" stroke="#b580ff" stroke-width="2" opacity="0.8"/>
        <!-- Residential 1 (220, 420) -->
        <line class="power-line" id="line-res1" x1="450" y1="240" x2="218" y2="418" stroke="#00ff88" stroke-width="1.5" opacity="0.6"/>
        <!-- Residential 2 (670, 420) -->
        <line class="power-line" id="line-res2" x1="450" y1="240" x2="672" y2="418" stroke="#00ff88" stroke-width="1.5" opacity="0.6"/>
        <!-- Residential 3 (80, 390) -->
        <line class="power-line" id="line-res3" x1="450" y1="240" x2="82" y2="392" stroke="#00ff88" stroke-width="1.2" opacity="0.5"/>
        <!-- Industrial (800, 180) -->
        <line class="power-line" id="line-ind" x1="450" y1="240" x2="798" y2="178" stroke="#ff7b00" stroke-width="1.5" opacity="0.7"/>
        <!-- Park/Public (350, 350) -->
        <line class="power-line" id="line-pub" x1="450" y1="240" x2="352" y2="348" stroke="#4dd9ff" stroke-width="1.2" opacity="0.6"/>
        <!-- Admin/H√∂kum…ôt (550, 350) -->
        <line class="power-line" id="line-adm" x1="450" y1="240" x2="548" y2="348" stroke="#4dd9ff" stroke-width="1.2" opacity="0.6"/>

        <!-- CENTRAL HUB GLOW -->
        <circle cx="450" cy="240" r="45" fill="url(#hub-grad)" opacity="0.6"/>
        <circle class="node-pulse" cx="450" cy="240" r="0" fill="none" stroke="#00ff88" stroke-width="1.5" opacity="0.8"/>
        <circle cx="450" cy="240" r="22" fill="rgba(0,20,12,0.9)" stroke="#00ff88" stroke-width="2" filter="url(#glow-green)"/>
        <text x="450" y="236" text-anchor="middle" font-family="Orbitron,monospace" font-size="9" fill="#00ff88" font-weight="700">M∆èRK∆èZ</text>
        <text x="450" y="248" text-anchor="middle" font-family="Share Tech Mono,monospace" font-size="7" fill="#00ff88">HUB</text>
        <text class="map-node-val" id="hub-kw" x="450" y="260" fill="#00ff88">500 MW</text>

        <!-- HOSPITAL 1 - x…ôst…ôxana 1 -->
        <circle cx="165" cy="85" r="18" fill="rgba(20,15,0,0.9)" stroke="#ffd700" stroke-width="2" filter="url(#glow-gold)"/>
        <text x="165" y="81" text-anchor="middle" font-size="14">üè•</text>
        <text class="map-node-label" x="165" y="94" fill="#ffd700">X-XANA 1</text>
        <text class="map-node-val" id="node-hosp1-kw" x="165" y="110" fill="#ffd700">‚Äî</text>

        <!-- HOSPITAL 2 - x…ôst…ôxana 2 -->
        <circle cx="738" cy="85" r="18" fill="rgba(20,15,0,0.9)" stroke="#ffd700" stroke-width="2" filter="url(#glow-gold)"/>
        <text x="738" y="81" text-anchor="middle" font-size="14">üè•</text>
        <text class="map-node-label" x="738" y="94" fill="#ffd700">X-XANA 2</text>
        <text class="map-node-val" id="node-hosp2-kw" x="738" y="110" fill="#ffd700">‚Äî</text>

        <!-- UNIVERSITY - universitet -->
        <circle cx="450" cy="45" r="18" fill="rgba(0,15,20,0.9)" stroke="#00e5cc" stroke-width="2"/>
        <text x="450" y="41" text-anchor="middle" font-size="14">üéì</text>
        <text class="map-node-label" x="450" y="50" fill="#00e5cc">UNƒ∞VER.</text>
        <text class="map-node-val" id="node-uni-kw" x="450" y="66" fill="#00e5cc">‚Äî</text>

        <!-- SCHOOL -->
        <circle cx="85" cy="205" r="16" fill="rgba(0,15,20,0.9)" stroke="#00e5cc" stroke-width="2"/>
        <text x="85" y="201" text-anchor="middle" font-size="12">üè´</text>
        <text class="map-node-label" x="85" y="210" fill="#00e5cc">M∆èKT∆èB</text>
        <text class="map-node-val" id="node-school-kw" x="85" y="225" fill="#00e5cc">‚Äî</text>

        <!-- DATA CENTER -->
        <circle cx="795" cy="305" r="20" fill="rgba(10,0,20,0.9)" stroke="#b580ff" stroke-width="2" filter="url(#glow-gold)"/>
        <text x="795" y="301" text-anchor="middle" font-size="14">üñ•</text>
        <text class="map-node-label" x="795" y="310" fill="#b580ff">DATA MRK</text>
        <text class="map-node-val" id="node-dc-kw" x="795" y="326" fill="#b580ff">‚Äî</text>

        <!-- RESIDENTIAL 1 -->
        <circle cx="218" cy="418" r="16" fill="rgba(0,15,5,0.9)" stroke="#00ff88" stroke-width="1.5"/>
        <text x="218" y="414" text-anchor="middle" font-size="12">üèò</text>
        <text class="map-node-label" x="218" y="423" fill="#00ff88">YA≈û. 1</text>
        <text class="map-node-val" id="node-res1-kw" x="218" y="438" fill="#00ff88">‚Äî</text>

        <!-- RESIDENTIAL 2 -->
        <circle cx="672" cy="418" r="16" fill="rgba(0,15,5,0.9)" stroke="#00ff88" stroke-width="1.5"/>
        <text x="672" y="414" text-anchor="middle" font-size="12">üèò</text>
        <text class="map-node-label" x="672" y="423" fill="#00ff88">YA≈û. 2</text>
        <text class="map-node-val" id="node-res2-kw" x="672" y="438" fill="#00ff88">‚Äî</text>

        <!-- RESIDENTIAL 3 -->
        <circle cx="82" cy="392" r="14" fill="rgba(0,15,5,0.9)" stroke="#00ff88" stroke-width="1.5"/>
        <text x="82" y="388" text-anchor="middle" font-size="11">üè†</text>
        <text class="map-node-label" x="82" y="397" fill="#00ff88">YA≈û. 3</text>
        <text class="map-node-val" id="node-res3-kw" x="82" y="410" fill="#00ff88">‚Äî</text>

        <!-- INDUSTRIAL -->
        <circle cx="798" cy="178" r="18" fill="rgba(15,8,0,0.9)" stroke="#ff7b00" stroke-width="2"/>
        <text x="798" y="174" text-anchor="middle" font-size="14">üè≠</text>
        <text class="map-node-label" x="798" y="183" fill="#ff7b00">S∆èNAY∆è</text>
        <text class="map-node-val" id="node-ind-kw" x="798" y="199" fill="#ff7b00">‚Äî</text>

        <!-- PUBLIC PARK -->
        <circle cx="352" cy="348" r="15" fill="rgba(0,10,15,0.9)" stroke="#4dd9ff" stroke-width="1.5"/>
        <text x="352" y="344" text-anchor="middle" font-size="11">üå≥</text>
        <text class="map-node-label" x="352" y="353" fill="#4dd9ff">ƒ∞CTƒ∞MAƒ∞</text>
        <text class="map-node-val" id="node-pub-kw" x="352" y="366" fill="#4dd9ff">‚Äî</text>

        <!-- ADMIN / H√∂kum…ôt -->
        <circle cx="548" cy="348" r="15" fill="rgba(0,10,15,0.9)" stroke="#4dd9ff" stroke-width="1.5"/>
        <text x="548" y="344" text-anchor="middle" font-size="11">üèõ</text>
        <text class="map-node-label" x="548" y="353" fill="#4dd9ff">ƒ∞DAR∆è</text>
        <text class="map-node-val" id="node-adm-kw" x="548" y="366" fill="#4dd9ff">‚Äî</text>

        <!-- Compass rose -->
        <g transform="translate(860,440)" opacity="0.4">
          <line x1="0" y1="-14" x2="0" y2="14" stroke="#00ff88" stroke-width="1"/>
          <line x1="-14" y1="0" x2="14" y2="0" stroke="#00ff88" stroke-width="1"/>
          <text x="0" y="-17" text-anchor="middle" font-family="Rajdhani" font-size="8" fill="#00ff88">N</text>
        </g>

        <!-- Scale bar -->
        <g transform="translate(30,460)" opacity="0.5">
          <line x1="0" y1="0" x2="60" y2="0" stroke="#00ff88" stroke-width="1"/>
          <line x1="0" y1="-4" x2="0" y2="4" stroke="#00ff88" stroke-width="1"/>
          <line x1="60" y1="-4" x2="60" y2="4" stroke="#00ff88" stroke-width="1"/>
          <text x="30" y="-6" text-anchor="middle" font-family="Share Tech Mono" font-size="7" fill="#00ff88">500 m</text>
        </g>
      </svg>
    </div>

    <!-- Bottom consumer stats -->
    <div class="map-bottom-stats">
      <div class="map-stat-item" id="mstat-hospital">
        <div class="map-stat-icon">üè•</div>
        <div class="map-stat-name">X…ôst…ôxanalar</div>
        <div class="map-stat-kw" id="mstat-hospital-kw" style="color:#ffd700">‚Äî</div>
        <div class="map-stat-pct" id="mstat-hospital-pct">‚Äî %</div>
      </div>
      <div class="map-stat-item" id="mstat-edu">
        <div class="map-stat-icon">üéì</div>
        <div class="map-stat-name">T…ôhsil</div>
        <div class="map-stat-kw" id="mstat-edu-kw" style="color:#00e5cc">‚Äî</div>
        <div class="map-stat-pct" id="mstat-edu-pct">‚Äî %</div>
      </div>
      <div class="map-stat-item" id="mstat-dc">
        <div class="map-stat-icon">üñ•</div>
        <div class="map-stat-name">Data M…ôrk…ôzi</div>
        <div class="map-stat-kw" id="mstat-dc-kw" style="color:#b580ff">‚Äî</div>
        <div class="map-stat-pct" id="mstat-dc-pct">‚Äî %</div>
      </div>
      <div class="map-stat-item" id="mstat-res">
        <div class="map-stat-icon">üèò</div>
        <div class="map-stat-name">Ya≈üayƒ±≈ü</div>
        <div class="map-stat-kw" id="mstat-res-kw" style="color:#00ff88">‚Äî</div>
        <div class="map-stat-pct" id="mstat-res-pct">‚Äî %</div>
      </div>
      <div class="map-stat-item" id="mstat-ind">
        <div class="map-stat-icon">üè≠</div>
        <div class="map-stat-name">S…ônaye / ƒ∞ctimai</div>
        <div class="map-stat-kw" id="mstat-ind-kw" style="color:#ff7b00">‚Äî</div>
        <div class="map-stat-pct" id="mstat-ind-pct">‚Äî %</div>
      </div>
    </div>
  </div>

  <!-- LOG PANEL -->
  <div class="log-panel">
    <div class="log-header">
      <div class="log-title">üì° Sistem Logu</div>
      <button class="log-clear" onclick="clearLog()">T…ômizl…ô</button>
    </div>
    <div class="log-container" id="logContainer"></div>
  </div>

</div>

<script>
// =============================================
// VERƒ∞L∆èR V∆è V∆èZƒ∞YY∆èT
// =============================================

const M∆èNB∆èL∆èRƒ∞ = {
  solar:   { ad: 'G√ºn…ô≈ü',       ikon: '‚òÄÔ∏è', r…ông: '#ffd700', klass: 'solar-card',   cClass: 'c-solar' },
  wind:    { ad: 'K√ºl…ôk',       ikon: 'üí®', r…ông: '#00e5cc', klass: 'wind-card',    cClass: 'c-wind'  },
  biogas:  { ad: 'Bioqaz',      ikon: 'üå±', r…ông: '#7fff7f', klass: 'biogas-card',  cClass: 'c-biogas'},
  storage: { ad: 'Storage',     ikon: 'üîã', r…ông: '#4dd9ff', klass: 'storage-card', cClass: 'c-storage'},
  piezo:   { ad: 'Pyezoelektrik',ikon:'‚ö°', r…ông: '#b580ff', klass: 'piezo-card',   cClass: 'c-piezo' }
};

const SSENARƒ∞L∆èR = {
  normal: {
    solar: 40, wind: 30, biogas: 15, storage: 11, piezo: 4,
    outputBase: 500,
    storageMode: 'charging',
    storageLevel: 72
  },
  cloudy: {
    solar: 10, wind: 8, biogas: 30, storage: 45, piezo: 7,
    outputBase: 320,
    storageMode: 'discharging',
    storageLevel: 58
  },
  critical: {
    solar: 2, wind: 2, biogas: 8, storage: 85, piezo: 3,
    outputBase: 85,
    storageMode: 'critical',
    storageLevel: 31
  }
};

let cariSsenariBa≈ülƒ±q = 'normal';
let cariPaylama = { solar: 40, wind: 30, biogas: 15, storage: 11, piezo: 4 };
let h…ôd…ôfPaylama = { ...cariPaylama };
let storageLevel = 72;
let h…ôd…ôfStorage = 72;
let outputHistory = Array(40).fill(500);
let tickSayacƒ± = 0;

// =============================================
// PIE CHART
// =============================================

function drawPie(paylama) {
  const canvas = document.getElementById('pieChart');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2, r = 110, innerR = 68;

  ctx.clearRect(0, 0, W, H);

  const a√ßƒ±lar = Object.entries(paylama);
  const r…ôngl…ôr = { solar:'#ffd700', wind:'#00e5cc', biogas:'#7fff7f', storage:'#4dd9ff', piezo:'#b580ff' };

  let ba≈ülanƒüƒ±c = -Math.PI / 2;
  const c…ôm = a√ßƒ±lar.reduce((s,[,v])=>s+v,0) || 1;

  a√ßƒ±lar.forEach(([key, val]) => {
    const dilim = (val / c…ôm) * 2 * Math.PI;
    const mid = ba≈ülanƒüƒ±c + dilim / 2;

    // K√∂lg…ô effekti
    ctx.shadowColor = r…ôngl…ôr[key];
    ctx.shadowBlur = 12;

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, ba≈ülanƒüƒ±c, ba≈ülanƒüƒ±c + dilim);
    ctx.closePath();
    ctx.fillStyle = r…ôngl…ôr[key];
    ctx.globalAlpha = 0.85;
    ctx.fill();

    // Ayrƒ±lƒ±q x…ôtti
    ctx.strokeStyle = '#020d0a';
    ctx.lineWidth = 2;
    ctx.stroke();

    ba≈ülanƒüƒ±c += dilim;
    ctx.globalAlpha = 1;
    ctx.shadowBlur = 0;
  });

  // M…ôrk…ôz dair…ôsi
  ctx.beginPath();
  ctx.arc(cx, cy, innerR, 0, 2 * Math.PI);
  ctx.fillStyle = '#061a14';
  ctx.fill();
  ctx.strokeStyle = 'rgba(0,255,136,0.2)';
  ctx.lineWidth = 1;
  ctx.stroke();

  // Xarici halqa
  ctx.beginPath();
  ctx.arc(cx, cy, r + 6, 0, 2 * Math.PI);
  ctx.strokeStyle = 'rgba(0,255,136,0.1)';
  ctx.lineWidth = 1;
  ctx.stroke();

  // Lejend yenil…ônm…ôsi
  const lejend = document.getElementById('pieLegend');
  lejend.innerHTML = '';
  Object.entries(paylama).forEach(([key, val]) => {
    const m = M∆èNB∆èL∆èRƒ∞[key];
    const div = document.createElement('div');
    div.className = 'legend-item';
    div.innerHTML = `
      <div class="legend-dot" style="background:${r…ôngl…ôr[key]};box-shadow:0 0 8px ${r…ôngl…ôr[key]}80"></div>
      <span class="legend-name">${m.ikon} ${m.ad}</span>
      <span class="legend-pct ${m.cClass}">${Math.round(val)}%</span>
    `;
    lejend.appendChild(div);
  });
}

// =============================================
// SPARKLINE
// =============================================

function drawSparkline() {
  const canvas = document.getElementById('sparkline');
  const ctx = canvas.getContext('2d');
  const W = canvas.width = canvas.offsetWidth || 280;
  const H = canvas.height = 50;

  ctx.clearRect(0, 0, W, H);

  const min = Math.min(...outputHistory) - 20;
  const max = Math.max(...outputHistory) + 20;
  const range = max - min || 1;

  const points = outputHistory.map((v, i) => ({
    x: (i / (outputHistory.length - 1)) * W,
    y: H - ((v - min) / range) * (H - 8) - 4
  }));

  // K√∂lg…ô doldurmaq
  const grad = ctx.createLinearGradient(0, 0, 0, H);
  grad.addColorStop(0, 'rgba(0,255,136,0.3)');
  grad.addColorStop(1, 'rgba(0,255,136,0)');

  ctx.beginPath();
  ctx.moveTo(points[0].x, H);
  ctx.lineTo(points[0].x, points[0].y);
  points.forEach(p => ctx.lineTo(p.x, p.y));
  ctx.lineTo(points[points.length-1].x, H);
  ctx.closePath();
  ctx.fillStyle = grad;
  ctx.fill();

  // X…ôtt
  ctx.beginPath();
  ctx.moveTo(points[0].x, points[0].y);
  points.forEach(p => ctx.lineTo(p.x, p.y));
  ctx.strokeStyle = '#00ff88';
  ctx.lineWidth = 2;
  ctx.shadowColor = '#00ff88';
  ctx.shadowBlur = 6;
  ctx.stroke();
  ctx.shadowBlur = 0;
}

// =============================================
// M∆èNB∆è KARTLARI
// =============================================

function initSourceCards() {
  const container = document.getElementById('sourceCards');
  container.innerHTML = '';
  const r…ôngl…ôr = { solar:'#ffd700', wind:'#00e5cc', biogas:'#7fff7f', storage:'#4dd9ff', piezo:'#b580ff' };

  Object.entries(M∆èNB∆èL∆èRƒ∞).forEach(([key, m]) => {
    const card = document.createElement('div');
    card.className = `source-card ${m.klass}`;
    card.id = `card-${key}`;
    card.innerHTML = `
      <div class="source-card-top">
        <div class="source-name">
          <span class="source-icon">${m.ikon}</span>
          <span class="${m.cClass}">${m.ad}</span>
        </div>
        <div class="source-pct ${m.cClass}" id="pct-${key}">--</div>
      </div>
      <div class="source-bar-bg">
        <div class="source-bar-fill" id="bar-${key}" style="background:${r…ôngl…ôr[key]};width:0%"></div>
      </div>
      <div class="source-status" id="status-${key}">Hesablanƒ±r...</div>
    `;
    container.appendChild(card);
  });
}

function updateSourceCards(paylama) {
  const statuslar = {
    normal:   { solar:'Normal ƒ∞stehsal', wind:'Normal ƒ∞stehsal', biogas:'Aktiv', storage:'≈ûarj Olunur ‚Üë', piezo:'Aktiv' },
    cloudy:   { solar:'Azaldƒ±lmƒ±≈ü ‚Üì', wind:'Azaldƒ±lmƒ±≈ü ‚Üì', biogas:'Artƒ±rƒ±lmƒ±≈ü ‚Üë', storage:'Storage ƒ∞≈ül…ôyir (Bo≈üalƒ±r)', piezo:'Stabil' },
    critical: { solar:'Kritik Minimum', wind:'Kritik Minimum', biogas:'Maksimum', storage:'TAM STORAGE REJƒ∞Mƒ∞ ‚ö°', piezo:'Aktiv' }
  };

  Object.keys(paylama).forEach(key => {
    const val = paylama[key];
    document.getElementById(`pct-${key}`).textContent = `${Math.round(val)}%`;
    document.getElementById(`bar-${key}`).style.width = `${val}%`;

    const st = statuslar[cariSsenariBa≈ülƒ±q]?.[key] || 'Aktiv';
    const statusEl = document.getElementById(`status-${key}`);
    statusEl.textContent = st;

    // Storage kartƒ± √º√ß√ºn x√ºsusi r…ông
    if (key === 'storage') {
      if (cariSsenariBa≈ülƒ±q === 'critical') statusEl.style.color = '#ff2244';
      else if (cariSsenariBa≈ülƒ±q === 'cloudy') statusEl.style.color = '#00e5cc';
      else statusEl.style.color = '#00ff88';
    } else {
      statusEl.style.color = '';
    }
  });
}

// =============================================
// STORAGE G√ñST∆èRƒ∞Cƒ∞Sƒ∞
// =============================================

function updateStorage(level, mode) {
  const fill = document.getElementById('batteryFill');
  const levelEl = document.getElementById('storageLevel');
  const statusEl = document.getElementById('storageStatusText');

  fill.style.height = `${level}%`;
  levelEl.textContent = `${Math.round(level)}%`;

  fill.className = 'battery-fill';
  statusEl.className = 'storage-status-text';

  if (mode === 'charging') {
    fill.classList.add('charging');
    statusEl.classList.add('status-charging');
    statusEl.textContent = '‚¨Ü Storage Dolur (Charging)';
  } else if (mode === 'discharging') {
    fill.classList.add('discharging');
    statusEl.classList.add('status-discharging');
    statusEl.textContent = '‚¨á Storage ƒ∞≈ül…ôyir (Bo≈üalƒ±r)';
  } else if (mode === 'critical') {
    fill.classList.add('critical');
    statusEl.classList.add('status-critical');
    statusEl.textContent = '‚ö° TAM STORAGE REJƒ∞Mƒ∞';
  } else {
    statusEl.classList.add('status-idle');
    statusEl.textContent = '‚Äî G√∂zl…ôm…ô Rejimi';
  }

  const storageCard = document.getElementById('card-storage');
  if (mode === 'critical') {
    storageCard.style.background = 'rgba(255,34,68,0.08)';
    storageCard.style.borderColor = 'rgba(255,34,68,0.4)';
  } else if (mode === 'discharging') {
    storageCard.style.background = 'rgba(0,229,204,0.08)';
    storageCard.style.borderColor = 'rgba(0,229,204,0.4)';
  } else {
    storageCard.style.background = '';
    storageCard.style.borderColor = '';
  }
}

// =============================================
// LOG Sƒ∞STEMƒ∞
// =============================================

function addLog(msg, n√∂v = 'info', m…ônb…ô = 'AI') {
  const container = document.getElementById('logContainer');
  const now = new Date();
  const vaxt = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;

  const div = document.createElement('div');
  div.className = 'log-line';
  div.innerHTML = `<span class="log-time">[${vaxt}]</span><span class="log-source">${m…ônb…ô}:</span><span class="log-msg ${n√∂v}">${msg}</span>`;

  container.insertBefore(div, container.firstChild);

  // Maksimum 50 s…ôtir
  while (container.children.length > 50) container.removeChild(container.lastChild);
}

function clearLog() {
  document.getElementById('logContainer').innerHTML = '';
  addLog('Log t…ômizl…ôndi.', 'info');
}

// =============================================
// SSENARƒ∞ QURMASI
// =============================================

function setScenario(ad) {
  cariSsenariBa≈ülƒ±q = ad;
  const s = SSENARƒ∞L∆èR[ad];
  h…ôd…ôfPaylama = { solar: s.solar, wind: s.wind, biogas: s.biogas, storage: s.storage, piezo: s.piezo };
  h…ôd…ôfStorage = s.storageLevel;

  // D√ºym…ô still…ôri
  document.querySelectorAll('.btn-scenario').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');

  // Alert banneri
  const banner = document.getElementById('alert-banner');
  if (ad === 'critical') {
    banner.style.display = 'block';
  } else {
    banner.style.display = 'none';
  }

  // Output r…ôngi
  const outVal = document.getElementById('outputValue');
  if (ad === 'critical') outVal.style.color = '#ff2244';
  else if (ad === 'cloudy') outVal.style.color = '#00e5cc';
  else outVal.style.color = '#00ff88';

  // Log yazƒ±larƒ±
  if (ad === 'normal') {
    addLog('Normal rejim aktivl…ô≈üdirildi. B√ºt√ºn m…ônb…ôl…ôr stabil.', 'success');
    addLog(`G√ºn…ô≈ü: ${s.solar}% | K√ºl…ôk: ${s.wind}% | Bioqaz: ${s.biogas}% ‚Äî Toplam: 500 MW`, 'info');
  } else if (ad === 'cloudy') {
    addLog('Buludlu hava a≈ükarlandƒ±! G√ºn…ô≈ü v…ô k√ºl…ôk enerjisi k…ôskin d√º≈üd√º.', 'warn');
    addLog('Storage aktivl…ô≈üdirildi (Iron-Air bo≈üalmaƒüa ba≈ülayƒ±r).', 'warn', 'AI');
    addLog(`Storage ƒ∞≈ül…ôyir (Bo≈üalƒ±r) ‚Äî S…ôviyy…ô: ${s.storageLevel}% ¬∑ 320 MW`, 'info', 'SYS');
    addLog('Bioqaz istehsalƒ± artƒ±rƒ±ldƒ±. Sistem balans saxlayƒ±r.', 'success', 'AI');
  } else if (ad === 'critical') {
    addLog('‚ö† KRƒ∞Tƒ∞K ENERJƒ∞ D√ú≈û√ú≈ûƒ∞ A≈ûKARLANDI!', 'error', 'AI');
    addLog('Tam Storage Rejimin…ô ke√ßildi. Iron-Air batareya aktiv.', 'error', 'AI');
    addLog(`Storage y√ºk√º: ${s.storage}% ‚Äî ƒ∞stehsal kritik minimum (85 MW).`, 'error', 'SYS');
    addLog('B√ºt√ºn qeyri-m√ºh√ºm y√ºkl…ôr s√∂nd√ºr√ºld√º.', 'warn', 'AI');
    addLog('≈û…ôb…ôk…ô m√ºhafiz…ô protokolu i≈ü…ô salƒ±ndƒ±.', 'warn', 'SYS');
  }
}

// =============================================
// MAP DISTRIBUTION UPDATE
// =============================================

// Priority weights per scenario (% of total output, scaled to match target MW)
// Normal 500MW: Hospitals=40, Edu=25, DC=60, Residential=200, Industry/Public=175
const MAP_WEIGHTS = {
  normal: {
    hosp1: 0.04, hosp2: 0.04, uni: 0.03, school: 0.02,
    dc: 0.12, res1: 0.14, res2: 0.14, res3: 0.12,
    ind: 0.20, pub: 0.065, adm: 0.065
  },
  cloudy: {
    hosp1: 0.06, hosp2: 0.06, uni: 0.04, school: 0.03,
    dc: 0.14, res1: 0.13, res2: 0.13, res3: 0.08,
    ind: 0.15, pub: 0.055, adm: 0.055
  },
  critical: {
    hosp1: 0.09, hosp2: 0.09, uni: 0.02, school: 0.01,
    dc: 0.18, res1: 0.10, res2: 0.10, res3: 0.06,
    ind: 0.14, pub: 0.055, adm: 0.055
  }
};

function updateMap(totalMw) {
  const w = MAP_WEIGHTS[cariSsenariBa≈ülƒ±q];
  const nodes = {
    hosp1: (totalMw * w.hosp1).toFixed(1),
    hosp2: (totalMw * w.hosp2).toFixed(1),
    uni:   (totalMw * w.uni).toFixed(1),
    school:(totalMw * w.school).toFixed(1),
    dc:    (totalMw * w.dc).toFixed(1),
    res1:  (totalMw * w.res1).toFixed(1),
    res2:  (totalMw * w.res2).toFixed(1),
    res3:  (totalMw * w.res3).toFixed(1),
    ind:   (totalMw * w.ind).toFixed(1),
    pub:   (totalMw * w.pub).toFixed(1),
    adm:   (totalMw * w.adm).toFixed(1)
  };

  const set = (id, val) => {
    const el = document.getElementById(id);
    if (el) el.textContent = val + ' MW';
  };

  set('hub-kw', parseFloat(totalMw).toFixed(0));
  set('node-hosp1-kw', nodes.hosp1);
  set('node-hosp2-kw', nodes.hosp2);
  set('node-uni-kw', nodes.uni);
  set('node-school-kw', nodes.school);
  set('node-dc-kw', nodes.dc);
  set('node-res1-kw', nodes.res1);
  set('node-res2-kw', nodes.res2);
  set('node-res3-kw', nodes.res3);
  set('node-ind-kw', nodes.ind);
  set('node-pub-kw', nodes.pub);
  set('node-adm-kw', nodes.adm);

  // Update bottom stats
  const hospTotal = (parseFloat(nodes.hosp1) + parseFloat(nodes.hosp2)).toFixed(1);
  const eduTotal  = (parseFloat(nodes.uni)   + parseFloat(nodes.school)).toFixed(1);
  const resTotal  = (parseFloat(nodes.res1)  + parseFloat(nodes.res2) + parseFloat(nodes.res3)).toFixed(1);
  const indTotal  = (parseFloat(nodes.ind)   + parseFloat(nodes.pub)  + parseFloat(nodes.adm)).toFixed(1);

  document.getElementById('mstat-hospital-kw').textContent = hospTotal + ' MW';
  document.getElementById('mstat-hospital-pct').textContent = Math.round(hospTotal/totalMw*100) + ' %';
  document.getElementById('mstat-edu-kw').textContent = eduTotal + ' MW';
  document.getElementById('mstat-edu-pct').textContent = Math.round(eduTotal/totalMw*100) + ' %';
  document.getElementById('mstat-dc-kw').textContent = parseFloat(nodes.dc).toFixed(1) + ' MW';
  document.getElementById('mstat-dc-pct').textContent = Math.round(nodes.dc/totalMw*100) + ' %';
  document.getElementById('mstat-res-kw').textContent = resTotal + ' MW';
  document.getElementById('mstat-res-pct').textContent = Math.round(resTotal/totalMw*100) + ' %';
  document.getElementById('mstat-ind-kw').textContent = indTotal + ' MW';
  document.getElementById('mstat-ind-pct').textContent = Math.round(indTotal/totalMw*100) + ' %';

  // Update power line animation speed based on scenario
  const lineClass = cariSsenariBa≈ülƒ±q === 'critical' ? 'power-line-critical' : 'power-line';
  document.querySelectorAll('[class^="power-line"]').forEach(el => {
    el.className.baseVal = lineClass;
  });
}

// =============================================
// ANƒ∞MASƒ∞YA D√ñNG√úS√ú
// =============================================

function lerp(a, b, t) { return a + (b - a) * t; }

function tick() {
  tickSayacƒ±++;
  const t = 0.05; // interpolasiya s√ºr…ôti

  // Paylama yenil…ônm…ôsi (hamar)
  Object.keys(cariPaylama).forEach(key => {
    cariPaylama[key] = lerp(cariPaylama[key], h…ôd…ôfPaylama[key], t);
  });

  // Storage yenil…ônm…ôsi
  storageLevel = lerp(storageLevel, h…ôd…ôfStorage, t);

  // Ki√ßik g√ºr√ºlt√º …ôlav…ôsi (realist g√∂r√ºn√º≈ü)
  const g√ºr√ºlt√º = (Math.random() - 0.5) * 0.3;
  const s = SSENARƒ∞L∆èR[cariSsenariBa≈ülƒ±q];
  const anlƒ±qOutput = s.outputBase + Math.sin(tickSayacƒ± * 0.08) * 8 + g√ºr√ºlt√º * 5;

  outputHistory.push(anlƒ±qOutput);
  if (outputHistory.length > 40) outputHistory.shift();

  // UI yenil…ônm…ôsi
  drawPie(cariPaylama);
  drawSparkline();
  updateSourceCards(cariPaylama);
  updateStorage(storageLevel, s.storageMode);

  updateMap(anlƒ±qOutput);
  document.getElementById('outputValue').textContent = Math.round(anlƒ±qOutput);
  document.getElementById('totalPct').textContent = `${Math.round(anlƒ±qOutput)} MW`;

  // Statistika
  document.getElementById('stat-solar').textContent = (anlƒ±qOutput * cariPaylama.solar / 100).toFixed(1);
  document.getElementById('stat-wind').textContent = (anlƒ±qOutput * cariPaylama.wind / 100).toFixed(1);
  document.getElementById('stat-co2').textContent = (1500 + (Math.random()-0.5)*5).toFixed(0);
  const efficiencies = { normal: 85.0, cloudy: 79.5, critical: 68.1 };
  document.getElementById('stat-efficiency').textContent = (efficiencies[cariSsenariBa≈ülƒ±q] + (Math.random()-0.5)*0.1).toFixed(1) + '%';

  // Avtomatik log (h…ôr 8 saniy…ô)
  if (tickSayacƒ± % 80 === 0) {
    const loglar = {
      normal: [
        ['Enerji balansƒ± optimal. ≈ûarj davam edir.', 'success'],
        ['G√ºn…ô≈ü panell…ôri tam g√ºc√ºnd…ô i≈ül…ôyir.', 'info', 'G√úN∆è≈û'],
        ['Storage s…ôviyy…ôsi stabil artmaqdadƒ±r.', 'success', 'BATT'],
        ['≈û…ôb…ôk…ô tezliyi: 50.00 Hz ‚Äî Normal', 'info', 'SYS'],
      ],
      cloudy: [
        ['Storage bo≈üalma s√ºr…ôti: 2.3%/saat', 'warn', 'BATT'],
        ['G√ºn…ô≈ü istehsalƒ± h…ôl…ô d…ô z…ôifdir.', 'warn', 'G√úN∆è≈û'],
        ['Bioqaz generatoru maksimum g√ºcd…ô.', 'info', 'Bƒ∞O'],
        ['AI: Y√ºk prioritetl…ôri yenil…ôndi.', 'info'],
      ],
      critical: [
        ['‚ö† Storage s…ôviyy…ôsi azalmaqdadƒ±r!', 'error', 'BATT'],
        ['Acil y√ºk azaldƒ±lmasƒ± tamamlandƒ±.', 'warn'],
        ['Ehtiyat dizel generatoru standby-da.', 'warn', 'SYS'],
        ['AI: ∆èsas ≈ü…ôb…ôk…ôy…ô qo≈üulmaƒüa hazƒ±r.', 'error'],
      ]
    };
    const secilmi≈üLoglar = loglar[cariSsenariBa≈ülƒ±q];
    const l = secilmi≈üLoglar[Math.floor(Math.random() * secilmi≈üLoglar.length)];
    addLog(l[0], l[1] || 'info', l[2] || 'AI');
  }
}

// =============================================
// SAAT
// =============================================

function updateClock() {
  const now = new Date();
  const s = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
  document.getElementById('clock').textContent = `${now.toLocaleDateString('az-AZ')} ¬∑ ${s}`;
}

// =============================================
// BA≈ûLANƒûIC
// =============================================

initSourceCards();
drawPie(cariPaylama);

addLog('Green Karabakh Enerji Sistemi i≈ü…ô salƒ±ndƒ±.', 'success');
addLog('AI n…ôzar…ôti aktivdir. B√ºt√ºn m…ônb…ôl…ôr stabil.', 'success');
addLog('Iron-Air Storage ≈üarj olunmaqdadƒ±r.', 'info', 'BATT');
addLog('Normal rejim: G√ºn…ô≈ü 40% | K√ºl…ôk 30% | Bioqaz 15% ‚Äî 500 MW', 'info', 'SYS');

setInterval(tick, 100);
setInterval(updateClock, 1000);
updateClock();
</script>
</body>
</html>
